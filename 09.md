# マイグレーションファイルを内容を間違えて作って、migrateもしてしまったがどうしたらよいか
# 解答記述欄

rails db:rollbackコマンドを打つことで一つ前の状態に戻ります。そこでマイグレーションファイルの内容を再編集してdb:migrateし直してください。ただし、最初の間違ったdb:migrateにおいてremoveを行っている場合は、rollbackする前にup,downメソッドにそれぞれupにremove処理(db:migrate時に読み込まれる)、downにadd処理（rollback時に読み込まれる）をマイグレーションファイルに記述しないといけません。




# レビュー記述欄
先にやってはいけない方法を述べておきます。
dbディレクトリのschemaファイルを編集して、rails db:resetだけはやらないようにしましょう。
rails db:resetはDBのデータを消して、DBをschemaファイルに基づいて構築し直すコマンドです。

schemaはmigrationファイルをまとめた内容で、rails db:migrateで反映されています。
つまりschemaの変更記録がmigrationファイルです。

schemaを直接書き換えたアプリケーションを誰かがクローンして、rails db:migrateをしたとき、schemaを書き換えた変更履歴は存在しないので、元のアプリケーションと異なるschemaが生成されてしまいます。

なので、schemaファイルを編集してrails db:resetをすることは厳禁です。

適切にDBを修正する方法は大きく3つになります
1. 更に変更するマイグレーションファイルを作成
2. migrationファイルを修正して、rails db:migrate:reset
3. migrationファイルを修正して、rails db:rollbackとrails db:migrate

変更を加えるマイグレーションファイルを作成する方法が最も適切です。
2と3はmigrationファイルを修正するため、共同作業者にまで余計な作業を強いることになります。

マイグレーションファイルの作成に関してまとめます
テーブル生成: rails g model xxxx
テーブル削除: rails d model xxxx
カラム追加 : rails g migrate AddColumnNameToTableName column_name:type
カラム削除 : rails g migrate RemoveColumnNameFromTableName column_name:type

以下、上記にあるコマンドの解説です。
rails db:migrate: まだmigrateしていないマイグレーションファイルをschemaに反映する
rails db:reset: DBのデータをdrop(削除)して、schemaからDBを再構築する。
rails db:migrate:reset: DBのデータをdropして、migrationファイルをもう一度読み直す
rails db:rollback: 直前のマイグレーションを取り消す
